# FastStream Subscriber

Контейнеризированное решение для запуска FastStream брокера и Swagger документации.

## Архитектура

- **fs-broker** - контейнер с FastStream брокером для обработки сообщений
- **fs-docs** - контейнер со Swagger документацией на порту 8081
- **kafka** - Kafka брокер для тестирования (опционально)
- **zookeeper** - Zookeeper для Kafka (опционально)

## Быстрый старт

### 1. Подготовка окружения

Скопируйте пример конфигурации:
```bash
cp env.example .env
```

Отредактируйте `.env` файл под ваши нужды.

### 2. Запуск всех сервисов

```bash
make up
```

### 3. Проверка статуса

```bash
make status
```

## Доступные команды

### Основные команды
- `make build` - собрать образы
- `make up` - запустить все сервисы
- `make down` - остановить все сервисы
- `make restart` - перезапустить все сервисы

### Логи
- `make logs` - логи всех сервисов
- `make broker-logs` - логи брокера
- `make docs-logs` - логи Swagger документации
- `make kafka-logs` - логи Kafka

### Выборочный запуск
- `make broker` - запустить только брокер
- `make docs` - запустить только Swagger документацию
- `make kafka-only` - запустить только Kafka и Zookeeper

### Управление
- `make status` - показать статус контейнеров
- `make clean` - полная очистка (контейнеры + образы + volumes)
- `make help` - показать эту справку

## Доступ к сервисам

- **Swagger документация**: http://localhost:8081
- **Kafka (локально)**: localhost:29092
- **Kafka (внутри Docker)**: kafka:9092

## Конфигурация

Основные настройки в `.env` файле:

```bash
# FastStream конфигурация
FS__FASTSTREAM__KAFKA_URL=kafka:9092
FS__FASTSTREAM__SUBJECT=user-register

# Логирование
FS__LOGGING__LOG_LEVEL=info
```

## Разработка

Для разработки с hot-reload:

```bash
# Запуск только брокера с hot-reload
make broker

# Запуск только документации
make docs
```

## Мониторинг

Проверить логи в реальном времени:
```bash
make logs
```

Проверить статус контейнеров:
```bash
make status
```

## Очистка

Полная очистка всех данных:
```bash
make clean
```

## Структура файлов

```
fs_subscriber/
├── app.py              # FastStream приложение
├── brokers.py          # Конфигурация Kafka брокера
├── settings.py         # Настройки приложения
├── users.py            # Роутер для пользователей
├── entrypoint.sh       # Скрипт запуска (локальный файл)
├── Dockerfile          # Docker образ
├── docker-compose.yml  # Оркестрация контейнеров
├── Makefile            # Команды для управления
├── run.sh              # Bash скрипт для быстрого запуска
└── env.example         # Пример конфигурации
```

## Особенности реализации

### Entrypoint скрипт
- **`entrypoint.sh`** - локальный файл, который копируется в контейнер
- **Читаемость**: Легко редактировать и понимать логику запуска
- **Отладка**: Можно тестировать локально перед сборкой образа
- **Эмодзи**: Красивые сообщения с эмодзи для лучшего UX

### Dockerfile
- **Базовый образ**: `python:3.12-slim` для минимального размера
- **Зависимости**: Управление через `uv` для быстрой установки
- **Копирование**: Сначала зависимости, потом код для оптимизации кэша
- **Комментарии**: Подробные комментарии для понимания каждого шага


