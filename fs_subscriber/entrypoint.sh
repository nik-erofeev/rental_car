#!/bin/bash

# Entrypoint —Å–∫—Ä–∏–ø—Ç –¥–ª—è FastStream Subscriber
# –ó–∞–ø—É—Å–∫–∞–µ—Ç –ª–∏–±–æ –±—Ä–æ–∫–µ—Ä, –ª–∏–±–æ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
if [ "$1" = "broker" ]; then
    echo "üöÄ –ó–∞–ø—É—Å–∫ FastStream –±—Ä–æ–∫–µ—Ä–∞..."
    echo "üì° –ë—Ä–æ–∫–µ—Ä –±—É–¥–µ—Ç —Å–ª—É—à–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è Kafka..."
    echo "üîÑ –í–∫–ª—é—á–µ–Ω hot-reload –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
    exec faststream run fs_subscriber.app:app --reload

elif [ "$1" = "docs" ]; then
    echo "üìö –ó–∞–ø—É—Å–∫ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
    echo "üåê –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8081"
    echo "üîó –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8081"
    exec faststream docs serve fs_subscriber.app:app --port 8081 --host 0.0.0.0

else
    echo "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: $1"
    echo ""
    echo "üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 [broker|docs]"
    echo ""
    echo "üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
    echo "  broker  - –ó–∞–ø—É—Å—Ç–∏—Ç—å FastStream –±—Ä–æ–∫–µ—Ä —Å hot-reload"
    echo "  docs    - –ó–∞–ø—É—Å—Ç–∏—Ç—å Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ –ø–æ—Ä—Ç—É 8081"
    echo ""
    echo "üí° –ü—Ä–∏–º–µ—Ä—ã:"
    echo "  $0 broker    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—Ä–æ–∫–µ—Ä"
    echo "  $0 docs      # –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
    exit 1
fi
